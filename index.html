<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fizz & Flow — Water, Fizzy Drinks & Juices</title>

    <!-- Tailwind (no build) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: "class", theme: { extend: {} } };</script>

    <!-- React 18 UMD + ReactDOM + Babel (JSX in browser) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- IMPORTANT: presets added so JSX compiles -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <meta name="theme-color" content="#0ea5e9" />

    <style>
      :root { --bg: 255 255 255; --fg: 17 24 39; }
      .dark { --bg: 10 10 10; --fg: 240 240 240; }
      body { background: rgb(var(--bg)); color: rgb(var(--fg)); }

      /* Category accent palettes */
      .theme-cat-water { --acc: #0ea5e9; --acc-50:#e0f2fe; --acc-100:#bae6fd; }
      .theme-cat-fizzy { --acc: #f43f5e; --acc-50:#ffe4e6; --acc-100:#fecdd3; }
      .theme-cat-juice { --acc: #f59e0b; --acc-50:#fef3c7; --acc-100:#fde68a; }
      .theme-cat-all   { --acc: #8b5cf6; --acc-50:#ede9fe; --acc-100:#ddd6fe; }

      .chip { font-size: .875rem; padding: .375rem .75rem; border-radius:9999px; border:1px solid #d1d5db; color:#374151; background:transparent; transition:all .2s; }
      .chip:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,0,0,.06); }
      .dark .chip { border-color:#374151; color:#e5e7eb; }
      .chip-active { background: var(--acc); color:#fff; border-color:transparent; }
      .dark .chip-active { background: var(--acc); color:#000; }

      .btn { padding:.5rem .75rem; border-radius:.75rem; border:1px solid #d1d5db; background:#fff; color:#111827; transition:all .2s; }
      .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,0,0,.08); }
      .dark .btn { border-color:#374151; background:#111827; color:#f3f4f6; }
      .btn-primary { background:var(--acc); color:#111827; border-color:transparent; }
      .btn-primary:hover { filter:saturate(1.1) brightness(1.05); }
      .dark .btn-primary { background:#fff; color:#000; }

      .card { padding:1rem; border:1px solid #e5e7eb; border-radius:1rem; background:#fff; transition:transform .2s, box-shadow .2s, border-color .2s; }
      .card:hover { transform: translateY(-2px) scale(1.01); box-shadow:0 20px 40px rgba(0,0,0,.08); border-color:var(--acc-100); }
      .dark .card { border-color:#1f2937; background:#0a0a0a; }
      .muted { color:#6b7280; } .dark .muted { color:#9ca3af; }
      .subtle { color:#4b5563; } .dark .subtle { color:#e5e7eb; }
      .input,.select { width:100%; border:1px solid #d1d5db; border-radius:.75rem; padding:.5rem .75rem; background:#fff; color:#111827; transition:border-color .2s, box-shadow .2s; }
      .input:focus,.select:focus { outline:none; border-color:var(--acc); box-shadow:0 0 0 4px var(--acc-50); }
      .dark .input,.dark .select { border-color:#374151; background:#111827; color:#f3f4f6; }
      .input::placeholder { color:#9ca3af; } .dark .input::placeholder { color:#6b7280; }
      .tag { font-size:.75rem; padding:.125rem .5rem; border-radius:9999px; border:1px solid #e5e7eb; } .dark .tag{border-color:#374151;}

      .badge-water { background:#e0f2fe; border-color:#bae6fd; }
      .badge-fizzy { background:#ffe4e6; border-color:#fecdd3; }
      .badge-juice { background:#fef3c7; border-color:#fde68a; }

      @keyframes fadeUp { from { opacity:0; transform:translateY(8px);} to { opacity:1; transform:translateY(0);} }
      .fade-in { animation: fadeUp .45s ease-out both; }
      @keyframes pop { 0%{transform:scale(1);}50%{transform:scale(1.03);}100%{transform:scale(1);} }
      .pop { animation: pop .25s ease-out; }
      @keyframes slideInRight { from{transform:translateX(100%);} to{transform:translateX(0);} }
      .slide-in-right { animation: slideInRight .3s ease-out both; }

      .hdr-grad { background: linear-gradient(90deg, var(--acc) 0%, #60a5fa 50%, #34d399 100%); height:3px; border-radius:9999px; }

      /* --- Image blending to hide white product backgrounds --- */
      .img-wrap { background: color-mix(in srgb, var(--acc-50) 80%, #fff 20%); }
      .drink-img { mix-blend-mode: multiply; image-rendering: auto; }
      .dark .drink-img { mix-blend-mode: screen; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- Run the app -->
    <script type="text/babel" data-presets="react,env">
      // ---------- helpers & data ----------
      const GBP = (n) => new Intl.NumberFormat("en-GB", { style: "currency", currency: "GBP" }).format(n);
      const round99 = (n) => Math.max(0, Math.round(n - 0.01) + 0.99);

      // Small inline SVG fallback (used if any asset is missing)
      function svgThumb({ brand, name, category }){
        const palette = {
          water: ['#38bdf8','#0ea5e9'],
          fizzy: ['#fb7185','#ef4444'],
          juice: ['#fbbf24','#f59e0b'],
          Tango: ['#111827','#ff7a00'],
          Barr: ['#d946ef','#0ea5e9'],
          Rubicon: ['#60a5fa','#1d4ed8']
        };
        const [c1,c2] = palette[brand] || palette[category] || ['#6b7280','#111827'];
        const svg = `<?xml version="1.0" encoding="UTF-8"?>
        <svg xmlns='http://www.w3.org/2000/svg' width='560' height='200'>
          <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
            <stop offset='0%' stop-color='${c1}'/><stop offset='100%' stop-color='${c2}'/>
          </linearGradient></defs>
          <rect width='100%' height='100%' fill='url(#g)'/>
          <g font-family='Inter,Segoe UI,system-ui' fill='white'>
            <text x='20' y='110' font-size='44' font-weight='800'>${brand}</text>
            <text x='20' y='150' font-size='22' opacity='0.9'>${name}</text>
          </g></svg>`;
        return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      }

      const CATEGORIES = [
        { id: 'all', label: 'All' },
        { id: 'water', label: 'Water' },
        { id: 'fizzy', label: 'Fizzy drinks' },
        { id: 'juice', label: 'Juices' },
      ];

      /*  Put these image files in your repo exactly like this:
          /assets/water/kirkland.png
          /assets/water/highland.png
          /assets/water/volvic.png
          /assets/water/voss.png
          /assets/fizzy/barr-cola.png
          /assets/fizzy/barr-lemonade.png
          /assets/fizzy/barr-bubblegum.png
          /assets/fizzy/barr-limeade.png
          /assets/fizzy/barr-raspberryade.png
          /assets/fizzy/barr-cream-soda.png
          /assets/fizzy/tango-orange.png
          /assets/fizzy/tango-apple-sf.png
          /assets/fizzy/tango-cherry-sf.png
          /assets/fizzy/rubicon-mango-sparkling.png
      */

      const PRODUCTS = [
        // Water
        { id:'kirkland-40',  brand:'Kirkland (Costco)', name:'Still Water', category:'water', packSize:40, unitMl:500, basePerUnit:0.30, tagline:'Great value everyday hydration', image:'/assets/water/kirkland.png' },
        { id:'highland-24',  brand:'Highland Spring',   name:'Still Water', category:'water', packSize:24, unitMl:500, basePerUnit:0.50, tagline:'Scottish spring water',          image:'/assets/water/highland.png' },
        { id:'volvic-24',    brand:'Volvic',            name:'Still Water', category:'water', packSize:24, unitMl:500, basePerUnit:0.54, tagline:'Volcanic mineral water',         image:'/assets/water/volvic.png' },
        { id:'voss-12',      brand:'Voss (Premium)',    name:'Still Water', category:'water', packSize:12, unitMl:500, basePerUnit:1.80, tagline:'Premium taste, sleek bottle',    image:'/assets/water/voss.png' },

        // Fizzy — Tango, Barr, Rubicon
        { id:'tango-24',              brand:'Tango', name:'Orange',               category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.55, sugarFree:false, tagline:'Full-on flavour', image:'/assets/fizzy/tango-orange.png' },
        { id:'tango-apple-sf-24',     brand:'Tango', name:'Apple (Sugar Free)',   category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.55, sugarFree:true,  tagline:'Crisp apple fizz', image:'/assets/fizzy/tango-apple-sf.png' },
        { id:'tango-cherry-sf-24',    brand:'Tango', name:'Cherry (Sugar Free)',  category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.60, sugarFree:true,  tagline:'Cherry blast',    image:'/assets/fizzy/tango-cherry-sf.png' },

        { id:'barr-cola-24',          brand:'Barr',  name:'Cola',                  category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.45, sugarFree:false, tagline:'Classic Barr cola',  image:'/assets/fizzy/barr-cola.png' },
        { id:'barr-lemonade-24',      brand:'Barr',  name:'Lemonade',              category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.42, sugarFree:false, tagline:'Sharp & zesty',      image:'/assets/fizzy/barr-lemonade.png' },
        { id:'barr-limeade-24',       brand:'Barr',  name:'Limeade (No Sugar)',    category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.42, sugarFree:true,  tagline:'Zingy lime',        image:'/assets/fizzy/barr-limeade.png' },
        { id:'barr-bubblegum-24',     brand:'Barr',  name:'Bubblegum (No Sugar)',  category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.46, sugarFree:true,  tagline:'Retro vibe',        image:'/assets/fizzy/barr-bubblegum.png' },
        { id:'barr-raspberryade-24',  brand:'Barr',  name:'Raspberryade (No Sugar)',category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.46, sugarFree:true, tagline:'Berry fizz',        image:'/assets/fizzy/barr-raspberryade.png' },
        { id:'barr-cream-24',         brand:'Barr',  name:'American Cream Soda',   category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.46, sugarFree:false, tagline:'Smooth & sweet',     image:'/assets/fizzy/barr-cream-soda.png' },

        { id:'rubicon-mango-sparkling-24', brand:'Rubicon', name:'Mango Sparkling', category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.75, sugarFree:false, tagline:'Exotic mango fizz', image:'/assets/fizzy/rubicon-mango-sparkling.png' },

        // Juices
        { id:'oj-12',        brand:'Tropicana', name:'Orange Juice (No Pulp)', category:'juice', packSize:12, unitMl:1000, basePerUnit:2.10, tagline:'100% squeezed' },
        { id:'aj-12',        brand:'Tropicana', name:'Apple Juice',            category:'juice', packSize:12, unitMl:1000, basePerUnit:1.90, tagline:'100% pressed' },
        { id:'smoothie-8',   brand:'Innocent',  name:'Strawberry Banana',      category:'juice', packSize:8,  unitMl:750,  basePerUnit:2.60, tagline:'Smoothie goodness' },
        { id:'oj-pressed-6', brand:'Innocent',  name:'Orange (Pressed)',       category:'juice', packSize:6,  unitMl:1500, basePerUnit:3.20, tagline:'Carafe 1.5L' },
      ];

      function computePrices(product){
        const subPackPrice = product.basePerUnit * product.packSize;
        const sub = round99(subPackPrice);
        const one = round99(sub * 1.25);
        const perUnitSub = round99(sub / product.packSize);
        const litres = (product.unitMl * product.packSize) / 1000;
        const perLiter = Math.round((sub / litres) * 100) / 100;
        return { sub, one, perUnitSub, perLiter };
      }

      const ls = {
        get:(k,f)=>{ try{const v=localStorage.getItem(k); return v?JSON.parse(v):f;}catch{return f;} },
        set:(k,v)=>{ try{localStorage.setItem(k,JSON.stringify(v));}catch{} },
      };

      // ---------- UI ----------
      function CategoryChips({ value, onChange }){
        return (
          <div className="flex flex-wrap gap-2 fade-in">
            {CATEGORIES.map(c => (
              <button key={c.id} className={`chip ${value===c.id? 'chip-active':''}`} onClick={()=>onChange(c.id)} aria-pressed={value===c.id}>
                {c.label}
              </button>
            ))}
          </div>
        );
      }

      function BrandChips({ value, onChange, brands }){
        if(!brands || brands.length<=1) return null;
        return (
          <div className="flex flex-wrap gap-2 fade-in">
            {["All", ...brands].map(b => (
              <button key={b} className={`chip ${value===b? 'chip-active':''}`} onClick={()=>onChange(b)} aria-pressed={value===b}>
                {b.replace(" (Costco)", "")}
              </button>
            ))}
          </div>
        );
      }

      function Hero({ best }){
        const pr = computePrices(best);
        return (
          <div className="card fade-in">
            <div className="text-xl font-semibold">Refresh on repeat</div>
            <div className="muted mt-1">
              Best value right now: <b>{best.brand} {best.name}</b> — {best.packSize}×{best.unitMl}ml from <b>{GBP(pr.sub)}</b> per delivery.
            </div>
            <div className="grid grid-cols-2 gap-2 text-sm mt-3">
              <div className="card"><span className="subtle">Per item (sub): </span><b>{GBP(pr.perUnitSub)}</b></div>
              <div className="card"><span className="subtle">Per litre: </span><b>{GBP(pr.perLiter)}</b></div>
            </div>
          </div>
        );
      }

      function ProductCard({ product, type, onAdd, highlight }){
        const pr = computePrices(product);
        const isSub = type === 'subscription';
        const price = isSub ? pr.sub : pr.one;
        const tags = [];
        if(product.category==='fizzy' && product.sugarFree) tags.push('Zero sugar');
        if(product.category==='water') tags.push('Still');
        if(product.category==='juice') tags.push('100% juice');

        return (
          <div className={`card fade-in ${highlight? 'border-[var(--acc)]':''}`} style={{animationDelay: `${Math.random()*0.15}s`}}>
            <div className="flex items-center justify-between">
              <div className="font-medium">{product.brand} — {product.name}</div>
              {highlight && <span className="tag text-blue-600 border-blue-300">Best value</span>}
            </div>

            {/* Image (tries asset, fall*

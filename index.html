<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fizz & Flow — Water, Fizzy Drinks & Juices</title>

    <!-- Tailwind (no build needed) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: "class", theme: { extend: {} } };
    </script>

    <!-- React 18 UMD + ReactDOM + Babel for JSX -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <meta name="theme-color" content="#0ea5e9" />

    <style>
      :root { --bg: 255 255 255; --fg: 17 24 39; }
      .dark { --bg: 10 10 10; --fg: 240 240 240; }
      body { background: rgb(var(--bg)); color: rgb(var(--fg)); }

      /* ---------- Palette by category ---------- */
      .theme-cat-water { --acc: #0ea5e9; --acc-50:#e0f2fe; --acc-100:#bae6fd; }
      .theme-cat-fizzy { --acc: #f43f5e; --acc-50:#ffe4e6; --acc-100:#fecdd3; }
      .theme-cat-juice { --acc: #f59e0b; --acc-50:#fef3c7; --acc-100:#fde68a; }
      .theme-cat-all   { --acc: #8b5cf6; --acc-50:#ede9fe; --acc-100:#ddd6fe; }

      /* ---------- Lightweight component styles ---------- */
      .chip { font-size: 0.875rem; padding: 0.375rem 0.75rem; border-radius: 9999px; border: 1px solid #d1d5db; color: #374151; background: transparent; transition: all .2s ease; }
      .chip:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,0,0,.06); }
      .dark .chip { border-color: #374151; color: #e5e7eb; }
      .chip-active { background: var(--acc); color: #ffffff; border-color: transparent; }
      .dark .chip-active { background: var(--acc); color: #000000; }

      .btn { padding: 0.5rem 0.75rem; border-radius: 0.75rem; border: 1px solid #d1d5db; background: #ffffff; color: #111827; transition: all .2s ease; }
      .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,0,0,.08); }
      .btn:active { transform: translateY(0); }
      .dark .btn { border-color: #374151; background: #111827; color: #f3f4f6; }
      .btn-primary { background: var(--acc); color: #111827; border-color: transparent; }
      .btn-primary:hover { filter: saturate(1.1) brightness(1.05); }
      .dark .btn-primary { background: #ffffff; color: #000000; }

      .card { padding: 1rem; border: 1px solid #e5e7eb; border-radius: 1rem; background: #ffffff; transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease; }
      .card:hover { transform: translateY(-2px) scale(1.01); box-shadow: 0 20px 40px rgba(0,0,0,.08); border-color: var(--acc-100); }
      .dark .card { border-color: #1f2937; background: #0a0a0a; }
      .muted { color: #6b7280; }
      .dark .muted { color: #9ca3af; }
      .subtle { color: #4b5563; }
      .dark .subtle { color: #e5e7eb; }
      .input, .select { width: 100%; border: 1px solid #d1d5db; border-radius: 0.75rem; padding: 0.5rem 0.75rem; background: #ffffff; color: #111827; transition: border-color .2s ease, box-shadow .2s ease; }
      .input:focus, .select:focus { outline: none; border-color: var(--acc); box-shadow: 0 0 0 4px var(--acc-50); }
      .dark .input, .dark .select { border-color: #374151; background: #111827; color: #f3f4f6; }
      .input::placeholder { color: #9ca3af; }
      .dark .input::placeholder { color: #6b7280; }
      .tag { font-size: 0.75rem; padding: 0.125rem 0.5rem; border-radius: 9999px; border: 1px solid #e5e7eb; }
      .dark .tag { border-color: #374151; }

      /* Category tag accents */
      .badge-water { background: #e0f2fe; border-color:#bae6fd; }
      .badge-fizzy { background: #ffe4e6; border-color:#fecdd3; }
      .badge-juice { background: #fef3c7; border-color:#fde68a; }

      /* ---------- Animations ---------- */
      @keyframes fadeUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
      .fade-in { animation: fadeUp .45s ease-out both; }

      @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
      .pop { animation: pop .25s ease-out; }

      @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
      .slide-in-right { animation: slideInRight .3s ease-out both; }

      /* Header gradient bar */
      .hdr-grad { background: linear-gradient(90deg, var(--acc) 0%, #60a5fa 50%, #34d399 100%); height: 3px; border-radius: 9999px; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      // ---------- helpers & data ----------
      const GBP = (n) => new Intl.NumberFormat("en-GB", { style: "currency", currency: "GBP" }).format(n);
      const round99 = (n) => Math.max(0, Math.round(n - 0.01) + 0.99);

      // small helper: jpg/webp usually have white backgrounds; blend them into the card
      const needsBlend = (src) => /\.(jpe?g|webp)$/i.test(src || "");

      // Always-available inline thumbnail (fallback) so cards never render blank
      function svgThumb({ brand, name, category }){
        const palette = {
          water: ['#38bdf8','#0ea5e9'],
          fizzy: ['#fb7185','#ef4444'],
          juice: ['#fbbf24','#f59e0b'],
          Tango: ['#111827','#ff7a00'],
          Barr: ['#d946ef','#0ea5e9'],
          Rubicon: ['#60a5fa','#1d4ed8']
        };
        const [c1,c2] = palette[brand] || palette[category] || ['#6b7280','#111827'];
        const svg = `<?xml version="1.0" encoding="UTF-8"?>
        <svg xmlns='http://www.w3.org/2000/svg' width='560' height='200'>
          <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
            <stop offset='0%' stop-color='${c1}'/><stop offset='100%' stop-color='${c2}'/>
          </linearGradient></defs>
          <rect width='100%' height='100%' fill='url(#g)'/>
          <g font-family='Inter,Segoe UI,system-ui' fill='white'>
            <text x='20' y='110' font-size='44' font-weight='800'>${brand}</text>
            <text x='20' y='150' font-size='22' opacity='0.9'>${name}</text>
          </g>
        </svg>`;
        return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      }

      const CATEGORIES = [
        { id: 'all', label: 'All' },
        { id: 'water', label: 'Water' },
        { id: 'fizzy', label: 'Fizzy drinks' },
        { id: 'juice', label: 'Juices' },
      ];

      const PRODUCTS = [
        // Water (change the paths if your filenames differ)
        { id:'kirkland-40',  brand:'Kirkland (Costco)', name:'Still Water',   category:'water', packSize:40, unitMl:500, basePerUnit:0.30, tagline:'Great value everyday hydration', image:'/assets/kirkland.jpg' },
        { id:'volvic-24',    brand:'Volvic',            name:'Still Water',   category:'water', packSize:24, unitMl:500, basePerUnit:0.54, tagline:'Volcanic mineral water',         image:'/assets/volvic.webp' },
        { id:'highland-24',  brand:'Highland Spring',   name:'Still Water',   category:'water', packSize:24, unitMl:500, basePerUnit:0.50, tagline:'Scottish spring water',          image:'/assets/highland.jpg' },
        { id:'voss-12',      brand:'Voss (Premium)',    name:'Still Water',   category:'water', packSize:12, unitMl:500, basePerUnit:1.80, tagline:'Premium taste, sleek bottle',    image:'/assets/voss.jpg' },

        // Fizzy — use your PNG cans if you have them; they look seamless
        { id:'barr-lemonade-24',     brand:'Barr', name:'Lemonade',              category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.42, sugarFree:false, tagline:'Sharp & zesty',                 image:'/assets/barr-lemonade.png' },
        { id:'barr-cola-24',         brand:'Barr', name:'Cola',                  category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.45, sugarFree:false, tagline:'Classic Barr cola',             image:'/assets/barr-cola.png' },
        { id:'barr-bubblegum-24',    brand:'Barr', name:'Bubblegum (No Sugar)',  category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.46, sugarFree:true,  tagline:'Retro vibe',                  image:'/assets/barr-bubblegum.png' },
        { id:'barr-limeade-24',      brand:'Barr', name:'Limeade (No Sugar)',    category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.42, sugarFree:true,  tagline:'Zingy lime',                  image:'/assets/barr-limeade.png' },
        { id:'barr-raspberryade-24', brand:'Barr', name:'Raspberryade (No Sugar)',category:'fizzy',packSize:24, unitMl:330, basePerUnit:0.46, sugarFree:true, tagline:'Berry fizz',                   image:'/assets/barr-raspberry.png' },
        { id:'barr-orangeade-24',    brand:'Barr', name:'Orangeade (Low Sugar)', category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.44, sugarFree:false, tagline:'Citrus pop',                   image:'/assets/barr-orange.png' },

        // Other fizzy
        { id:'tango-24',             brand:'Tango',   name:'Orange',              category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.55, sugarFree:false, tagline:'Full-on flavour',              image:'/assets/tango-orange.png' },
        { id:'tango-apple-sf-24',    brand:'Tango',   name:'Apple (Sugar Free)',  category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.55, sugarFree:true,  tagline:'Crisp apple fizz',            image:'/assets/tango-apple-sf.png' },
        { id:'tango-cherry-sf-24',   brand:'Tango',   name:'Cherry (Sugar Free)', category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.60, sugarFree:true,  tagline:'Cherry blast',                 image:'/assets/tango-cherry-sf.png' },
        { id:'rubicon-mango-sparkling-24', brand:'Rubicon', name:'Mango Sparkling', category:'fizzy', packSize:24, unitMl:330, basePerUnit:0.75, sugarFree:false, tagline:'Exotic mango fizz',        image:'/assets/rubicon-mango.png' },

        // Juices
        { id:'oj-12',         brand:'Tropicana',   name:'Orange Juice (No Pulp)', category:'juice', packSize:12, unitMl:1000, basePerUnit:2.10, tagline:'100% squeezed', image:'/assets/tropicana-oj.jpg' },
        { id:'aj-12',         brand:'Tropicana',   name:'Apple Juice',            category:'juice', packSize:12, unitMl:1000, basePerUnit:1.90, tagline:'100% pressed',  image:'/assets/tropicana-aj.jpg' },
        { id:'smoothie-8',    brand:'Innocent',    name:'Strawberry Banana',      category:'juice', packSize:8,  unitMl:750,  basePerUnit:2.60, tagline:'Smoothie goodness', image:'/assets/innocent-smoothie.jpg' },
        { id:'oj-pressed-6',  brand:'Innocent',    name:'Orange (Pressed)',       category:'juice', packSize:6,  unitMl:1500, basePerUnit:3.20, tagline:'Carafe 1.5L', image:'/assets/innocent-pressed.jpg' },
      ];

      function computePrices(product){
        const subPackPrice = product.basePerUnit * product.packSize;
        const sub = round99(subPackPrice);
        const one = round99(sub * 1.25);
        const perUnitSub = round99(sub / product.packSize);
        const litres = (product.unitMl * product.packSize) / 1000;
        const perLiter = Math.round((sub / litres) * 100) / 100;
        return { sub, one, perUnitSub, perLiter };
      }

      const ls = {
        get:(k,f)=>{ try{const v=localStorage.getItem(k); return v?JSON.parse(v):f;}catch{return f;} },
        set:(k,v)=>{ try{localStorage.setItem(k,JSON.stringify(v));}catch{} },
      };

      // ---------- components ----------
      function CategoryChips({ value, onChange }){
        return (
          <div className="flex flex-wrap gap-2 fade-in">
            {CATEGORIES.map(c => (
              <button key={c.id} className={`chip ${value===c.id? 'chip-active':''}`} onClick={()=>onChange(c.id)} aria-pressed={value===c.id}>
                {c.label}
              </button>
            ))}
          </div>
        );
      }

      function BrandChips({ value, onChange, brands }){
        if(!brands || brands.length<=1) return null;
        return (
          <div className="flex flex-wrap gap-2 fade-in">
            {["All", ...brands].map(b => (
              <button key={b} className={`chip ${value===b? 'chip-active':''}`} onClick={()=>onChange(b)} aria-pressed={value===b}>
                {b.replace(" (Costco)", "")}
              </button>
            ))}
          </div>
        );
      }

      function Hero({ best }){
        const pr = computePrices(best);
        return (
          <div className="card fade-in">
            <div className="text-xl font-semibold">Refresh on repeat</div>
            <div className="muted mt-1">
              Best value right now: <b>{best.brand} {best.name}</b> — {best.packSize}×{best.unitMl}ml from <b>{GBP(pr.sub)}</b> per delivery.
            </div>
            <div className="grid grid-cols-2 gap-2 text-sm mt-3">
              <div className="card"><span className="subtle">Per item (sub): </span><b>{GBP(pr.perUnitSub)}</b></div>
              <div className="card"><span className="subtle">Per litre: </span><b>{GBP(pr.perLiter)}</b></div>
            </div>
          </div>
        );
      }

      function ProductCard({ product, type, onAdd, highlight }){
        const pr = computePrices(product);
        const isSub = type === 'subscription';
        const price = isSub ? pr.sub : pr.one;
        const tags = [];
        if(product.category==='fizzy' && product.sugarFree) tags.push('Zero sugar');
        if(product.category==='water') tags.push('Still');
        if(product.category==='juice') tags.push('100% juice');

        const blend = needsBlend(product.image); // true for jpg/webp
         <img
          alt={`${product.brand} ${product.name}`}
          loading="lazy"
          src={product.image || svgThumb(product)}
          onError={(e)=>{ e.currentTarget.src = svgThumb(product); }}
          className="w-full h-36 object-contain bg-[var(--acc-50)] p-2 mix-blend-multiply"
           />




        return (
          <div className={`card fade-in ${highlight? 'border-[var(--acc)]':''}`} style={{animationDelay: `${Math.random()*0.15}s`}}>
            <div className="flex items-center justify-between">
              <div className="font-medium">{product.brand} — {product.name}</div>
              {highlight && <span className="tag text-blue-600 border-blue-300">Best value</span>}
            </div>

            <div className="relative mb-2 overflow-hidden rounded-xl border" style={{borderColor:'var(--acc-100)'}}>
              <img
                alt={`${product.brand} ${product.name}`}
                loading="lazy"
                src={product.image || svgThumb(product)}
                onError={(e)=>{ e.currentTarget.src = svgThumb(product); }}
                className={
                  "w-full h-36 object-contain p-2 " +
                  (product.image ? "bg-[var(--acc-50)] " : "") +
                  (blend ? "mix-blend-multiply brightness-105 contrast-110 " : "")
                }
              />
            </div>

            <div className="muted">{product.packSize}×{product.unitMl}ml • {product.tagline}</div>
            <div className="flex items-center gap-2 mt-1 flex-wrap">
              {tags.map(t => <span key={t} className="tag text-xs">{t}</span>)}
              <span className={`tag text-xs capitalize ${product.category==='water'? 'badge-water' : product.category==='fizzy'? 'badge-fizzy' : 'badge-juice'}`}>{product.category}</span>
            </div>
            <div className="flex items-end justify-between mt-2">
              <div>
                <div className="text-2xl font-semibold">{GBP(price)}</div>
                <div className="text-xs muted">{isSub? 'per delivery (subscription)':'one-off price'}</div>
              </div>
              <div className="text-xs text-right muted">
                <div>≈ {GBP(pr.perUnitSub)} / item (sub)</div>
                <div>≈ {GBP(pr.perLiter)} / litre</div>
              </div>
            </div>
            <button className="btn btn-primary w-full mt-3 active:scale-[.98]" onClick={(e)=>{ e.currentTarget.classList.add('pop'); setTimeout(()=>e.currentTarget.classList.remove('pop'), 260); onAdd({ id:product.id, brand:`${product.brand} — ${product.name}`, type, price }); }}>
              Add to {isSub? 'subscription':'basket'}
            </button>
          </div>
        );
      }

      function Cart({ cart, setCart, onClose, onCheckout }){
        const [address,setAddress] = React.useState("");
        const [windowSlot,setWindowSlot] = React.useState("8–11 AM");
        const [payment,setPayment] = React.useState("Apple Pay");
        const totals = cart.reduce((s,i)=>s + i.price * (i.qty||1), 0);
        function updateQty(id,type,d){ setCart(list=>list.map(x=>x.id===id && x.type===type ? {...x, qty:Math.max(1,(x.qty||1)+d)} : x)); }
        function removeItem(id,type){ setCart(list=>list.filter(x=>!(x.id===id && x.type===type))); }
        return (
          <div className="fixed inset-0 bg-black/40 flex">
            <div className="ml-auto w-full max-w-md h-full bg-white dark:bg-black p-4 overflow-auto text-gray-900 dark:text-gray-100 slide-in-right" style={{boxShadow:'-20px 0 40px rgba(0,0,0,.2)'}}>
              <div className="flex items-center justify-between mb-2">
                <div className="text-lg font-semibold">Your basket</div>
                <button className="btn" onClick={onClose}>Close</button>
              </div>
              {cart.length===0 ? (
                <div className="muted">Your basket is empty.</div>
              ) : (
                <>
                  {cart.map(item=> (
                    <div key={`${item.id}-${item.type}`} className="card mb-2 flex items-center justify-between">
                      <div>
                        <div className="text-sm font-medium">
                          {item.brand} <span className="tag ml-2">{item.type}</span>
                        </div>
                        <div className="text-xs muted">{GBP(item.price)} • qty {item.qty||1}</div>
                      </div>
                      <div className="flex items-center gap-2">
                        <button className="btn" onClick={()=>updateQty(item.id,item.type,-1)}>-</button>
                        <button className="btn" onClick={()=>updateQty(item.id,item.type,+1)}>+</button>
                        <button className="btn" onClick={()=>removeItem(item.id,item.type)}>✕</button>
                      </div>
                    </div>
                  ))}
                  <div className="card text-sm mb-2">
                    <div className="flex justify-between"><span>Total</span><span className="font-semibold">{GBP(totals)}</span></div>
                  </div>
                  <div className="space-y-2 mb-2">
                    <input className="input" placeholder="Flat • Street • Town • Postcode" value={address} onChange={e=>setAddress(e.target.value)} />
                    <select className="select" value={windowSlot} onChange={e=>setWindowSlot(e.target.value)}>
                      {["8–11 AM","11 AM–2 PM","2–6 PM","6–9 PM"].map(w=> <option key={w} value={w}>{w}</option>)}
                    </select>
                    <select className="select" value={payment} onChange={e=>setPayment(e.target.value)}>
                      {["Apple Pay","Google Pay","Visa","Mastercard"].map(p=> <option key={p} value={p}>{p}</option>)}
                    </select>
                  </div>
                  <button className="btn btn-primary w-full" onClick={()=>onCheckout({ address, windowSlot, payment })}>Place order</button>
                  <p className="text-xs muted text-center mt-2">Guest checkout allowed for one-off orders. Subscriptions require sign-in.</p>
                </>
              )}
            </div>
          </div>
        );
      }

      // ---------- App ----------
      function SimplyDrinksApp(){
        const [theme,setTheme] = React.useState(ls.get('sd-theme','light'));
        React.useEffect(()=>{ document.documentElement.classList.toggle('dark', theme==='dark'); ls.set('sd-theme',theme); },[theme]);

        const [user,setUser] = React.useState(ls.get('sd-user', null));
        React.useEffect(()=>ls.set('sd-user', user),[user]);

        const [tab,setTab] = React.useState('home');
        const [cart,setCart] = React.useState(ls.get('sd-cart', []));
        React.useEffect(()=>ls.set('sd-cart', cart),[cart]);

        const [showCart,setShowCart] = React.useState(false);
        const [lastOrder,setLastOrder] = React.useState(ls.get('sd-last-order', null));
        React.useEffect(()=>ls.set('sd-last-order', lastOrder),[lastOrder]);

        const [category,setCategory] = React.useState('all');
        const [brandFilter,setBrandFilter] = React.useState('All');
        const [q,setQ] = React.useState('');
        const [sort,setSort] = React.useState('value'); // value | price | name

        React.useEffect(()=>{ setBrandFilter('All'); },[category]);

        const visibleProducts = React.useMemo(()=>{
          let list = PRODUCTS.slice();
          if(category !== 'all') list = list.filter(p=>p.category===category);
          if(brandFilter !== 'All') list = list.filter(p=>p.brand===brandFilter);
          if(q.trim()){
            const qq = q.trim().toLowerCase();
            list = list.filter(p => (p.brand+" "+p.name+" "+(p.tagline||'')).toLowerCase().includes(qq));
          }
          list = list.map(p=>({ ...p, _prices: computePrices(p) }));
          if(sort==='value') list.sort((a,b)=> a._prices.perLiter - b._prices.perLiter);
          else if(sort==='price') list.sort((a,b)=> a._prices.sub - b._prices.sub);
          else if(sort==='name') list.sort((a,b)=> (a.brand+a.name).localeCompare(b.brand+b.name));
          return list;
        },[category, brandFilter, q, sort]);

        const brandsForCategory = React.useMemo(()=>{
          if(category==='all') return [];
          const pool = PRODUCTS.filter(p=>p.category===category);
          return Array.from(new Set(pool.map(p=>p.brand)));
        },[category]);

        const bestValueId = React.useMemo(()=>{
          let best = null; PRODUCTS.forEach(p=>{ const pr = computePrices(p); const score = pr.perLiter; if(!best || score < best.score) best = { id:p.id, score }; });
          return best?.id;
        },[]);

        function addToCart(item){
          setCart(prev=>{
            const i = prev.findIndex(x=>x.id===item.id && x.type===item.type);
            if(i>=0){ const copy=[...prev]; copy[i].qty+=1; return copy; }
            return [...prev,{...item,qty:1}];
          });
          setShowCart(true);
        }

        function checkout({ address, windowSlot, payment }){
          const subscription = cart.some(i=>i.type==='subscription');
          if(subscription && !user){ alert('Please sign in to start a subscription.'); return; }
          if(!address || address.trim().length<6){ alert('Please enter your delivery address.'); return; }
          const order={ id:`SD-${Date.now()}`, items:cart, address, window:windowSlot, paymentMethod:payment, ts:new Date().toISOString() };
          setLastOrder(order); setCart([]); setShowCart(false); alert("Order placed! You'll get a confirmation shortly.");
        }

        const best = PRODUCTS.find(p=>p.id===bestValueId) || PRODUCTS[0];
        const searchPlaceholder = category==='all' ? 'Search brand, drink, flavour…' : `Search ${CATEGORIES.find(c=>c.id===category).label.toLowerCase()}…`;

        return (
          <div className={`theme-cat-${category} max-w-5xl mx-auto p-4`}>
            {/* header */}
            <div className="sticky top-0 bg-white/70 dark:bg-black/70 backdrop-blur border-b mb-4">
              <div className="max-w-5xl mx-auto p-3">
                <div className="flex items-center gap-3">
                  <div className="font-semibold text-lg">Fizz & Flow</div>
                  <span className="tag">Keep the fizz. Feel the flow.</span>
                  <div className="ml-auto flex items-center gap-2">
                    {!user && <span className="tag">Guest</span>}
                    <button className="btn" onClick={()=>setTheme(theme==='light'?'dark':'light')}>{theme==='light'? 'Dark':'Light'}</button>
                    <button className="btn" onClick={()=>setShowCart(true)}>Cart ({cart.reduce((s,i)=>s+(i.qty||1),0)})</button>
                  </div>
                </div>
                <div className="hdr-grad mt-3"></div>
              </div>
            </div>

            {/* guest banner */}
            {!user && (
              <div className="card mb-3 flex items-center justify-between fade-in">
                <div>
                  <div className="font-medium">You’re browsing as a guest</div>
                  <div className="muted">Subscribe & reorder in one tap when you sign up.</div>
                </div>
                <button className="btn btn-primary" onClick={()=>setUser({ id:`user-${Date.now()}`, name:'Customer' })}>Sign up</button>
              </div>
            )}

            {/* tabs */}
            <div className="grid grid-cols-4 gap-2 mb-3 fade-in">
              {['home','subscribe','shop','account'].map(t=> (
                <button key={t} onClick={()=>setTab(t)} className={`py-2 rounded border transition-all ${tab===t? 'bg-gray-900 text-white dark:bg-white dark:text-black border-transparent' : 'border-gray-300 dark:border-gray-700 hover:border-[var(--acc)]'}`}>
                  {t[0].toUpperCase()+t.slice(1)}
                </button>
              ))}
            </div>

            {/* filters */}
            {(tab==='subscribe' || tab==='shop' || (!lastOrder && tab==='home')) && (
              <div className="space-y-3 mb-3">
                <CategoryChips value={category} onChange={setCategory} />
                {category!=='all' && <BrandChips value={brandFilter} onChange={setBrandFilter} brands={brandsForCategory} />}
                <div className="grid sm:grid-cols-3 gap-2">
                  <input className="input" placeholder={searchPlaceholder} value={q} onChange={e=>setQ(e.target.value)} />
                  <select className="select sm:col-span-1" value={sort} onChange={e=>setSort(e.target.value)}>
                    <option value="value">Sort: Best value</option>
                    <option value="price">Sort: Lowest price</option>
                    <option value="name">Sort: Name</option>
                  </select>
                </div>
              </div>
            )}

            {tab==='home' && (
              <div className="space-y-4">
                <Hero best={best} />
                {lastOrder ? (
                  <div className="card flex items-center justify-between fade-in">
                    <div className="text-sm">
                      <div className="font-medium">Quick Reorder</div>
                      <div className="muted">{lastOrder.items.map(i=>i.brand).join(', ')}</div>
                    </div>
                    <button className="btn btn-primary" onClick={()=>{ setCart(lastOrder.items.map(i=>({...i}))); setShowCart(true); }}>Order again</button>
                  </div>
                ) : (
                  <div className="card fade-in">
                    <div className="font-medium mb-2">Start a subscription</div>
                    <div className="grid sm:grid-cols-2 gap-3">
                      {(visibleProducts.length?visibleProducts:PRODUCTS).map(p => (
                        <ProductCard key={`home-${p.id}`} product={p} type="subscription" highlight={p.id===bestValueId} onAdd={addToCart} />
                      ))}
                    </div>
                  </div>
                )}
              </div>
            )}

            {tab==='subscribe' && (
              <div className="space-y-3">
                <div className="muted">Save ~20% vs one-off. Cancel anytime.</div>
                <div className="grid sm:grid-cols-2 gap-3">
                  {visibleProducts.map(p => (
                    <ProductCard key={`sub-${p.id}`} product={p} type="subscription" highlight={p.id===bestValueId} onAdd={addToCart} />
                  ))}
                </div>
              </div>
            )}

            {tab==='shop' && (
              <div className="grid sm:grid-cols-2 gap-3">
                {visibleProducts.map(p => (
                  <ProductCard key={`shop-${p.id}`} product={p} type="one-off" highlight={p.id===bestValueId} onAdd={addToCart} />
                ))}
              </div>
            )}

            {tab==='account' && (
              <div className="space-y-3">
                <div className="card fade-in">
                  <div className="font-medium mb-1">Account</div>
                  <div className="text-sm">{user? 'Signed in' : 'Guest'}</div>
                  {user && <button className="btn mt-2" onClick={()=>setUser(null)}>Log out</button>}
                </div>
                {lastOrder && (
                  <div className="card text-sm fade-in">
                    <div className="font-medium">Last order</div>
                    <div className="muted">{new Date(lastOrder.ts).toLocaleDateString('en-GB')}</div>
                  </div>
                )}
              </div>
            )}

            {showCart && <Cart cart={cart} setCart={setCart} onClose={()=>setShowCart(false)} onCheckout={checkout} />}
          </div>
        );
      }

      // tiny tests
      (function(){ try{ console.assert(round99(12.34)===12.99,'round99'); const p=computePrices(PRODUCTS[0]); console.assert(p.one>=p.sub,'pricing'); } catch(e){ console.warn('Test warning:', e); } })();

      ReactDOM.createRoot(document.getElementById('root')).render(<SimplyDrinksApp />);
    </script>
  </body>
</html>
